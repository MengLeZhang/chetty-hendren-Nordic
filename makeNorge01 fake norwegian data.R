##  makeFake01 -- this is the fake nordic data that Henrik preprocesses. This is the fields
## This is the raw data file -- if we are using it that is!

# Data A: 
#   Datasetname = ???
#     
#     
#     Id    yr    born    inc    CZ        fam_id      fam_inc
#   1     1990    1981    108    1106        7        
#   â€¦                    7
#   1    1996    1981    201    1106        7
#   1    1997    1981    201    1106        10
#   1    1998    1981    201    1107        10
#   1    ...    1981    201    1107        10
#   1    2019    1981    201    1107        
#   
#   2    1990    1981
#   2    ...    ...
#   2    2019    1981
#   

# From shared google doc
# id <str>: id string for person
# yr <num>: year of observation
# born <num>: year person born 
# inc <num>: income in year . Example 108
# cz <str>: id for cz recorded at (jan 1) each year
# fam_id: id of family 
# fam_inc: income of family


library(tidyverse)
library(haven)


## What's the dataset name

dataName = 'thisFake.dta'

## time-invariant stuff           

nID <- 1e3

thisPerson <-
  data.frame(
    id = 1:nID,
    fam_id = sample.int(nID, nID, replace = T),
    born = 1979 + sample.int(19, nID, replace = T)
  )

## The time varying data -- create as a function
# 1996 -2021

timeData <- 
  function(id, nYr = 20){
    # nYr # this defines length
    yr = 1980 + 1:nYr ## this defines the length
    tempOut <- 
      data.frame(
        id = id,
        yr = yr,
        inc = 100 + sample.int(40, nYr, replace =T),
        ## family
        fam_inc = 200 + sample.int(80, nYr, replace =T)
      ) %>%
        mutate(
          ## fake moving data 
          firstBSU = 1000 + sample.int(400, nYr, replace = T),
          firstCZ = 1000 + sample.int(100, nYr, replace = T),
          
          
          bsu = ifelse(
            runif(nYr, min = 0, max = 1) > 0.1, #i.e. probability of not moving
            firstBSU,
            1000 + sample.int(400)
          ),
          
          CZ = ifelse(
            bsu == firstBSU,
            firstCZ,
            1000 + sample.int(100, nYr, replace = T)
          )
        )
    
    return(tempOut)
  }

timeData(1)
## run it 

fakeOut <- 
  map_df(1:nID, timeData) 

fakeOut <-
  thisPerson %>%
  left_join(fakeOut)

## save the output 
haven::write_dta(fakeOut, 
                 'fake nordic data' %>% 
                   file.path(dataName)
                 )


